{% extends 'erpera_reports/templates/pages/base.html' %}

{% block page_content %}
    <div class="overview-cards">
        <div class="card">
            <div class="card-icon products">üí∞</div>
            <div class="card-value">{{ total_purchase }} <span style="color: #dc2626; font-size: 0.8em; font-weight: 500;">({{ current_fiscal_year }})</span></div>
            <div class="card-label">Total Purchase</div>
        </div>
        <div class="card">
            <div class="card-icon orders">üìÑ</div>
            <div class="card-value">{{ invoice_count }} <span style="color: #dc2626; font-size: 0.8em; font-weight: 500;">({{ current_fiscal_year }})</span></div>
            <div class="card-label">Total Invoices</div>
        </div>
        <div class="card">
            <div class="card-icon stock">üè¢</div>
            <div class="card-value">{{ supplier_count }}</div>
            <div class="card-label">Unique Suppliers</div>
        </div>
        <div class="card">
            <div class="card-icon out-of-stock">üìä</div>
            <div class="card-value">{{ avg_invoice_value }} <span style="color: #dc2626; font-size: 0.8em; font-weight: 500;">({{ current_month }})</span></div>
            <div class="card-label">Average Purchase Value</div>
        </div>
    </div>

    
    <div class="section-container">
        <h2 class="section-title">Total Buying</h2>
        <div class="charts-row">
            {% set chart_id = 'branchWiseBuying' %}
            {% set title = 'Branch Wise Buying' %}
            {% set backgroundColor = '#059669' %}
            {% set chart_type = 'bar' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.buying.get_branch_wise_buying' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": company_list },
              { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": branch_list }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}

            {% set chart_id = 'companyWiseBuying' %}
            {% set title = 'Company Wise Buying' %}
            {% set backgroundColor = '#059669' %}
            {% set chart_type = 'bar' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.buying.get_company_wise_buying' %}
            {% set filters = [
                { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
                { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
                { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": company_list }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}

            {% set chart_id = 'buyingSummary' %}
            {% set title = 'Buying Summary' %}
            {% set backgroundColor = '#059669' %}
            {% set chart_type = 'bar' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.buying.get_buying_summary' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
              { "label": "Item", "fieldtype": "Select", "fieldname": "item", "options": item_list },
              { "label": "Item Group", "fieldtype": "Select", "fieldname": "item_group", "options": item_group_list },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": company_list },
              { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": branch_list }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}
        </div>
    </div>

    <div class="section-container">
        <h2 class="section-title">Consolidated Total Buying</h2>
        <div class="charts-row">
            {% set chart_id = 'consolidatedTotalBuying' %}
            {% set title = 'Consolidated Total Buying' %}
            {% set backgroundColor = '#059669' %}
            {% set chart_type = 'bar' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.buying.consolidated_total_buying' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": company_list },
              { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": branch_list }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}

            {% set chart_id = 'entityWiseBuying' %}
            {% set title = 'Entity Wise Buying' %}
            {% set backgroundColor = '#059669' %}
            {% set chart_type = 'bar' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.buying.get_entity_summary' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": company_list },
              { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": branch_list }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}
        </div>
    </div>

    <div class="section-container">
        <h2 class="section-title">Top Suppliers</h2>
        <div class="charts-row">
            {% set chart_id = 'topSuppliersByBranch' %}
            {% set title = 'Top Suppliers by Branch' %}
            {% set backgroundColor = '#059669' %}
            {% set chart_type = 'bar' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.buying.get_top_supplier_for_expenses_raw_bar' %}
            {% set filters = [
                { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
                { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
                { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": company_list },
                { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": branch_list }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}
        </div>
    </div>

    <div class="section-container">
        <h2 class="section-title">Top Buying Products</h2>
        <div class="charts-row">
            {% set chart_id = 'topBuyingProductsByBranch' %}
            {% set title = 'Top Buying Products by Branch' %}
            {% set data_url = 'erpera_reports.buying.get_top_buying_products_by_branch' %}
            {% set width = 12 %}
            {% set filters = [
                { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
                { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
                { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": company_list },
                { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": branch_list },
                { "label": "Item", "fieldtype": "Select", "fieldname": "item", "options": item_list },
                { "label": "Item Group", "fieldtype": "Select", "fieldname": "item_group", "options": item_group_list }
            ] %}
            {% include "erpera_reports/templates/includes/multi_pie.html" %}

            {% set chart_id = 'topBuyingProductsByCompany' %}
            {% set title = 'Top Buying Products by Company' %}
            {% set data_url = 'erpera_reports.buying.get_top_buying_products_by_company' %}
            {% set width = 12 %}
            {% set filters = [
                { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
                { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
                { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": company_list },
                { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": branch_list },
                { "label": "Item", "fieldtype": "Select", "fieldname": "item", "options": item_list },
                { "label": "Item Group", "fieldtype": "Select", "fieldname": "item_group", "options": item_group_list }
            ] %}
            {% include "erpera_reports/templates/includes/multi_pie.html" %}
        </div>
    </div>

    <div class="section-container">
        <h2 class="section-title">Most Expenses Head</h2>
        <div class="charts-row">
            {% set chart_id = 'mostExpensesHeadByBranch' %}
            {% set title = 'Most Expenses Head by Branch' %}
            {% set data_url = 'erpera_reports.buying.get_most_expenses_head_by_branch' %}
            {% set width = 12 %}
            {% set filters = [
                { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
                { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
                { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": company_list },
                { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": branch_list },
                { "label": "Item Group", "fieldtype": "Select", "fieldname": "item_group", "options": item_group_list }
            ] %}
            {% include "erpera_reports/templates/includes/multi_pie.html" %}

            {% set chart_id = 'mostExpensesHeadByCompany' %}
            {% set title = 'Most Expenses Head by Company' %}
            {% set data_url = 'erpera_reports.buying.get_most_expenses_head_by_company' %}
            {% set width = 12 %}
            {% set filters = [
                { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
                { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
                { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": company_list },
                { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": branch_list },
                { "label": "Item Group", "fieldtype": "Select", "fieldname": "item_group", "options": item_group_list }
            ] %}
            {% include "erpera_reports/templates/includes/multi_pie.html" %}
        </div>
    </div>

    <div class="section-container">
        <h2 class="section-title">Consolidate Most Purchase Head</h2>
        <div class="charts-row">
            {% set chart_id = 'consolidateMostPurchaseHead' %}
            {% set title = 'Top 10 Expense Categories Overall' %}
            {% set backgroundColor = '#059669' %}
            {% set chart_type = 'pie' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.buying.get_consolidate_most_purchase_head' %}
            {% set filters = [
                { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
                { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
                { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": company_list },
                { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": branch_list },
                { "label": "Item Group", "fieldtype": "Select", "fieldname": "item_group", "options": item_group_list }
            ] %}
            {% include "erpera_reports/templates/includes/doughnut.html" %}
        </div>
    </div>

    <!-- Space for future sections -->

{% endblock %}

<style>
.section-container {
    margin: 2rem 0;
    padding: 1rem;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.section-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #059669;
}

.charts-row {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1rem;
}
</style>
