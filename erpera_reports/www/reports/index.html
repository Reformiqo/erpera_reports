{% extends 'erpera_reports/templates/pages/base.html' %}

{% block page_content %}
    <div class="overview-cards">
        <div class="card">
            <div class="card-icon purchase-orders">üõí</div>
            <div class="card-value">{{ summary_cards.purchase_orders.count or 0 }}</div>
            <div class="card-label">Purchase Orders</div>
            <p style="color: #dc2626; font-size: 12px; font-weight: 500;">(This Month)</p>
            {% if summary_cards.purchase_orders.amount_growth %}
            <div class="growth-indicator {{ 'positive' if summary_cards.purchase_orders.amount_growth > 0 else 'negative' if summary_cards.purchase_orders.amount_growth < 0 else 'neutral' }}">
                {{ "‚Üó" if summary_cards.purchase_orders.amount_growth > 0 else "‚Üò" if summary_cards.purchase_orders.amount_growth < 0 else "‚Üí" }} {{ summary_cards.purchase_orders.amount_growth|abs }}%
            </div>
            {% endif %}
        </div>
        
        <div class="card">
            <div class="card-icon purchase-receipts">üöö</div>
            <div class="card-value">{{ summary_cards.purchase_receipts.count or 0 }}</div>
            <div class="card-label">Purchase Receipts</div>
            <p style="color: #dc2626; font-size: 12px; font-weight: 500;">(This Month)</p>
            {% if summary_cards.purchase_receipts.amount_growth %}
            <div class="growth-indicator {{ 'positive' if summary_cards.purchase_receipts.amount_growth > 0 else 'negative' if summary_cards.purchase_receipts.amount_growth < 0 else 'neutral' }}">
                {{ "‚Üó" if summary_cards.purchase_receipts.amount_growth > 0 else "‚Üò" if summary_cards.purchase_receipts.amount_growth < 0 else "‚Üí" }} {{ summary_cards.purchase_receipts.amount_growth|abs }}%
            </div>
            {% endif %}
        </div>
        
        <div class="card">
            <div class="card-icon purchase-invoices">üí∞</div>
            <div class="card-value">{{ summary_cards.purchase_invoices.count or 0 }}</div>
            <div class="card-label">Purchase Invoices</div>
            <p style="color: #dc2626; font-size: 12px; font-weight: 500;">(This Month)</p>
            {% if summary_cards.purchase_invoices.amount_growth %}
            <div class="growth-indicator {{ 'positive' if summary_cards.purchase_invoices.amount_growth > 0 else 'negative' if summary_cards.purchase_invoices.amount_growth < 0 else 'neutral' }}">
                {{ "‚Üó" if summary_cards.purchase_invoices.amount_growth > 0 else "‚Üò" if summary_cards.purchase_invoices.amount_growth < 0 else "‚Üí" }} {{ summary_cards.purchase_invoices.amount_growth|abs }}%
            </div>
            {% endif %}
        </div>
        
        <div class="card">
            <div class="card-icon suppliers">üë•</div>
            <div class="card-value">{{ summary_cards.suppliers.total_suppliers or 0 }}</div>
            <div class="card-label">Total Suppliers</div>
            <p style="color: #10b981; font-size: 12px; font-weight: 500;">({{ summary_cards.suppliers.active_suppliers or 0 }} Active)</p>
        </div>
        
        <div class="card">
            <div class="card-icon outstanding">‚ö†Ô∏è</div>
            <div class="card-value">
                {% set outstanding = summary_cards.outstanding.total_outstanding or 0 %}
                {% if outstanding >= 10000000 %}
                    ‚Çπ{{ "%.1f"|format(outstanding/10000000) }}Cr
                {% elif outstanding >= 100000 %}
                    ‚Çπ{{ "%.1f"|format(outstanding/100000) }}L
                {% elif outstanding >= 1000 %}
                    ‚Çπ{{ "%.1f"|format(outstanding/1000) }}K
                {% else %}
                    ‚Çπ{{ outstanding|int }}
                {% endif %}
            </div>
            <div class="card-label">Outstanding Amount</div>
            <p style="color: #dc2626; font-size: 12px; font-weight: 500;">({{ summary_cards.outstanding.overdue_count or 0 }} Overdue)</p>
        </div>
    </div>

 

    <div class="section-container">
        <h2 class="section-title">Top Selling & Low Performing SKUs</h2>
        <div class="charts-row">
            {% set chart_id = 'topSellingSkus' %}
            {% set title = 'Top 20 Fast-Moving Items (By Quantity)' %}
            {% set backgroundColor = '#10b981' %}
            {% set chart_type = 'bar' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_top_selling_skus' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": [] },
              { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": [] }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}

            {% set chart_id = 'lowPerformingSkus' %}
            {% set title = 'Bottom 20 Slow-Moving Items (By Quantity)' %}
            {% set backgroundColor = '#ef4444' %}
            {% set chart_type = 'bar' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_low_performing_skus' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": [] },
              { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": [] }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}
        </div>
        
        <div class="charts-row">
            {% set chart_id = 'topRevenueItems' %}
            {% set title = 'Top 20 Items by Revenue' %}
            {% set backgroundColor = '#8b5cf6' %}
            {% set chart_type = 'bar' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_top_revenue_items' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": [] },
              { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": [] }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}

            {% set chart_id = 'itemCategoryPerformance' %}
            {% set title = 'Item Category Performance' %}
            {% set backgroundColor = '#f59e0b' %}
            {% set chart_type = 'doughnut' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_item_category_performance' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": [] },
              { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": [] }
            ] %}
            {% include "erpera_reports/templates/includes/doughnut.html" %}
        </div>
        
        <div class="charts-row">
            {% set chart_id = 'skuVelocityTrend' %}
            {% set title = 'SKU Velocity Trend (Top 10 Items - 30 Days)' %}
            {% set backgroundColor = '#06b6d4' %}
            {% set chart_type = 'line' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_sku_velocity_trend' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": [] },
              { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": [] }
            ] %}
            {% include "erpera_reports/templates/includes/line.html" %}
        </div>
    </div>

    <div class="section-container">
        <h2 class="section-title">Purchase vs Sales Consumption Report</h2>
        <p class="section-description">Track purchases vs actual sales to manage overbuying or understocking risks</p>
        
        <div class="charts-row">
            {% set chart_id = 'purchaseVsSalesOverview' %}
            {% set title = 'Purchase vs Sales Overview (Monthly)' %}
            {% set backgroundColor = '#3b82f6' %}
            {% set chart_type = 'line' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_purchase_vs_sales_overview' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": [] }
            ] %}
            {% include "erpera_reports/templates/includes/line.html" %}
        </div>
        
      
        
        <div class="charts-row">
            {% set chart_id = 'understockRiskItems' %}
            {% set title = 'Understock Risk Items' %}
            {% set backgroundColor = '#f59e0b' %}
            {% set chart_type = 'bar' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_understock_risk_items' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": [] }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}

            {% set chart_id = 'consumptionRatio' %}
            {% set title = 'Purchase to Sales Ratio by Category' %}
            {% set backgroundColor = '#8b5cf6' %}
            {% set chart_type = 'doughnut' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_consumption_ratio' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": [] }
            ] %}
            {% include "erpera_reports/templates/includes/doughnut.html" %}
        </div>
        
        <div class="charts-row">
            {% set chart_id = 'inventoryTurnoverAnalysis' %}
            {% set title = 'Inventory Turnover Analysis' %}
            {% set backgroundColor = '#06b6d4' %}
            {% set chart_type = 'bar' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_inventory_turnover_analysis' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": [] }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}

            {% set chart_id = 'stockEfficiencyScore' %}
            {% set title = 'Stock Efficiency Score' %}
            {% set backgroundColor = '#84cc16' %}
            {% set chart_type = 'doughnut' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_stock_efficiency_score' %}
            {% set filters = [
              { "label": "Period", "fieldtype": "Select", "fieldname": "period", "options": [
                {"value": "month", "label": "This Month"},
                {"value": "quarter", "label": "This Quarter"},
                {"value": "year", "label": "This Year"}
              ] }
            ] %}
            {% include "erpera_reports/templates/includes/doughnut.html" %}
        </div>
    </div>

    <div class="section-container">
        <h2 class="section-title">Daily Sales Summary Report</h2>
        <div class="charts-row">
            {% set chart_id = 'dailySalesSnapshot' %}
            {% set title = 'Daily Sales Snapshot Across All Branches' %}
            {% set backgroundColor = '#22c55e' %}
            {% set chart_type = 'bar' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_daily_sales_snapshot' %}
            {% set filters = [
              { "label": "Date", "fieldtype": "Date", "fieldname": "date" },
              { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": [] },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": [] }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}
        </div>
        
        <div class="charts-row">
            {% set chart_id = 'salesByBranch' %}
            {% set title = 'Sales by Branch (Today)' %}
            {% set backgroundColor = '#3b82f6' %}
            {% set chart_type = 'bar' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_sales_by_branch' %}
            {% set filters = [
              { "label": "Date", "fieldtype": "Date", "fieldname": "date" },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": [] }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}

            {% set chart_id = 'paymentModeBreakdown' %}
            {% set title = 'Payment Mode Breakdown (Today)' %}
            {% set backgroundColor = '#8b5cf6' %}
            {% set chart_type = 'doughnut' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_payment_mode_breakdown' %}
            {% set filters = [
              { "label": "Date", "fieldtype": "Date", "fieldname": "date" },
              { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": [] }
            ] %}
            {% include "erpera_reports/templates/includes/doughnut.html" %}
        </div>
        
        <div class="charts-row">
            {% set chart_id = 'hourlySales' %}
            {% set title = 'Hourly Sales Trend (Today)' %}
            {% set backgroundColor = '#f59e0b' %}
            {% set chart_type = 'line' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_hourly_sales_trend' %}
            {% set filters = [
              { "label": "Date", "fieldtype": "Date", "fieldname": "date" },
              { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": [] }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}

            {% set chart_id = 'salesSummaryStats' %}
            {% set title = 'Daily Sales Summary Stats' %}
            {% set backgroundColor = '#06b6d4' %}
            {% set chart_type = 'bar' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_daily_sales_stats' %}
            {% set filters = [
              { "label": "Date", "fieldtype": "Date", "fieldname": "date" },
              { "label": "Branch", "fieldtype": "Select", "fieldname": "branch", "options": [] }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}
        </div>
    </div>

    <div class="section-container">
        <h2 class="section-title">Monthly Purchase Summary</h2>
        <div class="charts-row">
            {% set chart_id = 'monthlyPurchaseTrend' %}
            {% set title = 'Monthly Purchase Trend' %}
            {% set backgroundColor = '#667eea' %}
            {% set chart_type = 'line' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_monthly_purchase_trend' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": [] }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}
        </div>
    </div>

    <div class="section-container">
        <h2 class="section-title">Purchase Analytics</h2>
        <div class="charts-row">
            {% set chart_id = 'topSuppliers' %}
            {% set title = 'Top Suppliers This Month' %}
            {% set backgroundColor = '#10b981' %}
            {% set chart_type = 'bar' %}
            {% set width = 6 %}
            {% set data_url = 'erpera_reports.dashboard.get_top_suppliers' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
              { "label": "Limit", "fieldtype": "Select", "fieldname": "limit", "options": [
                {"value": "5", "label": "Top 5"},
                {"value": "10", "label": "Top 10"},
                {"value": "20", "label": "Top 20"}
              ] }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}

            {% set chart_id = 'purchaseByStatus' %}
            {% set title = 'Purchase Orders by Status' %}
            {% set backgroundColor = '#f59e0b' %}
            {% set chart_type = 'doughnut' %}
            {% set width = 6 %}
            {% set data_url = 'erpera_reports.dashboard.get_purchase_by_status' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" }
            ] %}
            {% include "erpera_reports/templates/includes/doughnut.html" %}
        </div>
    </div>

    <div class="section-container">
        <h2 class="section-title">Outstanding Analysis</h2>
        <div class="charts-row">
            {% set chart_id = 'outstandingBySupplier' %}
            {% set title = 'Outstanding by Supplier' %}
            {% set backgroundColor = '#ef4444' %}
            {% set chart_type = 'bar' %}
            {% set width = 6 %}
            {% set data_url = 'erpera_reports.dashboard.get_outstanding_by_supplier' %}
            {% set filters = [
              { "label": "Limit", "fieldtype": "Select", "fieldname": "limit", "options": [
                {"value": "10", "label": "Top 10"},
                {"value": "20", "label": "Top 20"},
                {"value": "50", "label": "Top 50"}
              ] }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}

            {% set chart_id = 'agingAnalysis' %}
            {% set title = 'Outstanding Aging Analysis' %}
            {% set backgroundColor = '#8b5cf6' %}
            {% set chart_type = 'doughnut' %}
            {% set width = 6 %}
            {% set data_url = 'erpera_reports.dashboard.get_aging_analysis' %}
            {% include "erpera_reports/templates/includes/doughnut.html" %}
        </div>
    </div>

    <div class="section-container">
        <h2 class="section-title">Purchase Performance</h2>
        <div class="charts-row">
            {% set chart_id = 'companyWisePurchases' %}
            {% set title = 'Company Wise Purchases' %}
            {% set backgroundColor = '#06b6d4' %}
            {% set chart_type = 'bar' %}
            {% set width = 12 %}
            {% set data_url = 'erpera_reports.dashboard.get_company_wise_purchases' %}
            {% set filters = [
              { "label": "From Date", "fieldtype": "Date", "fieldname": "from_date" },
              { "label": "To Date", "fieldtype": "Date", "fieldname": "to_date" },
              { "label": "Company", "fieldtype": "Select", "fieldname": "company", "options": [] }
            ] %}
            {% include "erpera_reports/templates/includes/bar.html" %}
        </div>
    </div>

{% endblock %}

<style>
.section-container {
    margin: 2rem 0;
    padding: 1rem;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.section-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #667eea;
}

.charts-row {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1rem;
}

/* Custom card icons */
.card-icon.purchase-orders {
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
}

.card-icon.purchase-receipts {
    background: linear-gradient(135deg, #10b981, #047857);
}

.card-icon.purchase-invoices {
    background: linear-gradient(135deg, #f59e0b, #d97706);
}

.card-icon.suppliers {
    background: linear-gradient(135deg, #8b5cf6, #7c3aed);
}

.card-icon.outstanding {
    background: linear-gradient(135deg, #ef4444, #dc2626);
}

/* Growth indicators */
.growth-indicator {
    font-size: 11px;
    padding: 2px 6px;
    border-radius: 12px;
    margin-top: 4px;
    display: inline-block;
    font-weight: 600;
}

.growth-indicator.positive {
    background: #dcfce7;
    color: #166534;
}

.growth-indicator.negative {
    background: #fef2f2;
    color: #dc2626;
}

.growth-indicator.neutral {
    background: #f3f4f6;
    color: #6b7280;
}
</style>
